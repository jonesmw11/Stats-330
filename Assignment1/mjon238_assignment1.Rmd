---
title: "mjon238_Assignment1"
author: "mjon238"
date: "09/01/2022"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyr)
library(tidyverse)
library(ggplot2)

lobsterdf <- read_csv('lobster.csv')
stPauldf <- read_csv('st-paul.csv')
```

Question 1)

a) For each row in the data set, calculate the proportion of lobsters that survived.Print the proportions out, and add them as a new column to the data set.

```{r}
#Print proportion of lobsters that survived for each row
`colnames<-`(lobsterdf[,3]/lobsterdf[,2], 'propotion_survived')

#Add that to the dataframe
lobsterdf <- lobsterdf%>%
  transmute(size,
            n,
            survived,
            'proportion_survived' = survived/n)

#Show the dataFrame
lobsterdf

```
b) Fit the same model that the authors did. Show the code you used to fit the model,
and print the summary() output.

We are trying to determine how  "a juvenile lobster’s size was related to its vulnerability to predation". When using linear regression we will use proportion_survived as our response variable and size as an explanatory variable.

```{r}

lobster.fit <- lm(proportion_survived ~ size,  data = lobsterdf)
summary(lobster.fit)

```
c) Create a scatter plot of size against the proportion of surviving lobsters.

```{r}
#Plotting our linear regression model
plot(lobsterdf$size, 
     lobsterdf$proportion_survived,
     main = "Plotting Lobster linear model against data (Linear Regression)",
     xlab = 'The rounded carapace length of a group of lobsters (mm)',
     ylab = 'Propotion of lobsters in group that survived',
     pch = 19)
abline(lobster.fit, col = 'blue', lwd = 1.5)

```


d) Interpret the effects estimated by your model.

We estimate that for every 1 millimeter increase in the rounded carapace length of a group of lobsters, the expected proportion of lobsters in that group that survive increases by approximately 0.035569.

e) List the reasons why by explaining how assumptions required by the model do not hold.

In linear regression the ith observations response ($proportion\_survived_i$) comes from a normal distribution. This indicates that for observation size  = 27, the model suggests it would be likely that there is a negative of proportion of lobsters in that group that survived. This is clearly implausible and therefore the assumption is violated.

This becomes a clear issue when we either make predictions outside of the data range or when predicting proportion survived for the largest group (57mm).
```{r}
#if size = 20
predict.lm(lobster.fit, newdata = data.frame(size = 20))

#If size = 57
predict.lm(lobster.fit, newdata = data.frame(size = 57))

```
Both results are either greater than 1 or less than 0, which is clearly nonsense.


Linear regression also assumes a constant variance. This is unlikely because lobster groups where the proportion survived = 0.5 will have a greater variation than the very large lobsters, which probably all survived, or the very small lobsters, which probably all died.



f) Select a model you think is appropriate for these data. Show the code you used to fit
the model, and print the summary() output.

We will fit a logistic regression, with binomial distribution, and predict the odds of survival.

```{r}
lobster.fit2 <- glm(cbind(survived, n - survived) ~ size, lobsterdf, family = "binomial")
summary(lobster.fit2)

```




g) Interpret the effects estimated by your model.

```{r}
#Log odds
coef(lobster.fit2)

#Odds
exp(coef(lobster.fit2))
```

We estimate that for every 1mm increase in the rounded carapace length of a lobster, the odds of survival are multiplied by 1.216 times.


h) Recreate your plot 

```{r}
#define new data frame that contains predictor variable
newdata <- data.frame(size=seq(20, 60,len=500))

#use fitted model to predict values of proportion survived
newdata$proportion_survived <- predict(lobster.fit2, newdata, type="response")

#plot logistic regression curve
plot(proportion_survived ~ size, data = lobsterdf,
     main = "Plotting Lobster model against data (Logistic Regression)",
     xlab = 'The rounded carapace length of a group of lobsters (mm)',
     ylab = 'Propotion of lobsters in group that survived',
      pch = 19)
lines(proportion_survived ~ size, newdata, lwd=1.5, col = 'blue')


```




Question 2)
a) Create this plot, and comment briefly.

```{r}

## To make five plots stack on top of each other and to minimise margins between plots.
par(mfcol = c(5, 1), mar = c(4, 4, 2, 0.2), las = 1)
## A call to barplot() to create each individual plot.
barplot(prop.table(table(stPauldf$kais[stPauldf$work == "Romans"])),
main = "Romans", names.arg = rep("", 5), ylim = c(0, 0.8))
barplot(prop.table(table(stPauldf$kais[stPauldf$work == "Corinthians1"])),
main = "1 Corinthians", names.arg = rep("", 5), ylim = c(0, 0.8))
barplot(prop.table(table(stPauldf$kais[stPauldf$work == "Corinthians2"])),
main = "2 Corinthians", ylab = "Proportion of Sentences",
names.arg = rep("", 5), ylim = c(0, 0.8))
barplot(prop.table(table(stPauldf$kais[stPauldf$work == "Galatians"])),
main = "Galatians", names.arg = rep("", 5), ylim = c(0, 0.8))
barplot(prop.table(table(stPauldf$kais[stPauldf$work == "Philippians"])),
main = "Philippians", xlab = "Number of Kais", ylim = c(0, 0.8))


```


In each epistle kai is more often not used than used.

Philippians is the only epistle with clearly a different spread of kais. The proportion of sentences with 0 kais is lower than compared to other epistles. It also has proportionally the most sentences with 2 or 3 kais.

The other epistles have a similar spread. However Galatians and Romans have a proportionally higher number of sentences with 3 kais than 1 Corinthians and 2 Corinthians.

2 Corinthians has a proportionally higher number of sentences with 2 kais relative to Romans, Galatians and 1 Corinthians.

Based on the plots, I would assume that Philippians has a unique author. It is not clear if the other epistles have a unique author.

We will need to run a model.


b) Fit a model to compare how the average number of times the word “kai” appears
in a sentence varies between the five works. 

```{r}
#We are looking at counts, so we will use a Poisson distribution

stPaul.fit1 <- glm(kais ~ work, family = 'poisson', data = stPauldf)
summary(stPaul.fit1)
exp(coef(stPaul.fit1))

```

c) Fit a model to compare how the average number of times the word “kai” appears
in a sentence varies between the five works. 

$exp(\beta_0) = 0.4338118$.

If the epistle is '1 Corinthians', we estimate that the expected average number of kais per sentence to be multiplied by 0.4338.

The Romans coefficient is statistically insignificant. This means the expected number of kais per sentence for Romans is statistically equal to 1 Corinthians. 


d) Conduct an appropriate hypothesis test and write a brief summary.

We can define H0: $\beta_1 = \beta_2 = \beta_3 = \beta_4 = 0$ 

I.e Average number of kais per sentence are the same for all epistles, and therefore all works have the same author.

We will use Anova testing to test the null hypothesis
```{r}
anova(stPaul.fit1, test = 'Chisq')

#Anova testing suggests some factor variables are significant


```

We reject the null (p-value approximately 0), there is strong evidence that there is at least one epistle with a different average number of kais per sentence. Suggesting there is more than one author.

e) For which works does there appear to be evidence of a difference from 1 Corinthians,
in terms of the expected number of occurrences of “kai” per sentence?

Lets examine the summary again.

```{r}
summary(stPaul.fit1)

```
Our base level is 1 Corinthians. 

The P-Value for the Philippians epistle is very small (and clearly statistically significant). 
Therefore, it is highly likely that the Philippians epistle has a different number of average kais per sentence than 1 Corinthians, suggesting Philippians has a different author than 1 Corinthians.

The P-Value for 2 Corinthians is larger, but still statistically significant. This suggests there is some evidence that 2 Corinthians has a different number of average kais per sentence to 1 Corinthians and consequently a different author.



f) For which works does there appear to be evidence of a difference from Philippians, in
terms of the number of the expected number of occurrences of “kai” per sentence?

We first change the baseline to Philippians, then reexamine a summary.
```{r}

unique(stPauldf$work)
stPauldf$work <- factor(stPauldf$work, c('Philippians', "Romans",
                                         "Corinthians1", "Corinthians2",
                                         "Galatians"))

stPaul.fit2 <- glm(kais ~ work, family = 'poisson', stPauldf)
summary(stPaul.fit2)
```

We have set Philippians to our base, now all coefficients corresponding to different works are statistically significant. This suggests that average number of kais per sentence is statistically different to all other works.

I.e. Philippians has a unique author.



```{r}
print('End Of Assignment 1')
```











